/*
 * Copyright (c) 2015 by Greg Reimer <gregreimer@gmail.com>
 * All Rights Reserved.
 */

var koa = require('koa')
  , serve = require('koa-static')
  , route = require('koa-route')
  , babel = require('babel')
  , codeMap = new Map()

var app = module.exports = koa()

app.use(serve('./static'))

app.use(route.get('/transpile/:code', function*(code) {
  if (!codeMap.has(code)) {
    console.log(code)
    var transpiled = babel.transform(code)
    console.log(transpiled)
    codeMap.set(code, transpiled)
  }
  this.set('content-type', 'text/javascript; charset=utf-8')
  this.body = codeMap.get(code).code
}))
