/*
 * Copyright (c) 2015 by Greg Reimer <gregreimer@gmail.com>
 * All Rights Reserved.
 */

var pony = require('../index')
  , assert = require('assert')

describe('eventual-pony', function(){

  describe('writables', function(){

    it('should create a writable', function(done){

      var wr = pony.writable(function* (input) {
        var data = yield input('utf8')
        assert.strictEqual(data, 'hello')
        done()
      })
      wr.end('hello')
      wr.on('error', done)
    })

    it('should error', function(done){

      var wr = pony.writable(function* (input) {
        var data = yield input('utf8')
        throw new Error('fake')
      })
      wr.end('hello')
      wr.on('error', function(err){
        assert.strictEqual(err.message, 'fake')
        done()
      })
    })
  })

  describe('readables', function(){

    it('should create a readable', function(done){

      pony.readable(function* (output) {
        yield output('hello')
      }).on('data', function(data) {
        assert.strictEqual(data.toString('utf8'), 'hello')
        done()
      }).on('error', done)
    })
  })

  describe('transforms', function(){

    it('should create a transform', function(done){

      var tr = pony.transform(function* (input, output) {
        yield output(yield input())
      })
      tr.on('data', function(data) {
        assert.strictEqual(data.toString('utf8'), 'hello')
        done()
      }).on('error', done)
      tr.write('hello')
    })
  })
})

