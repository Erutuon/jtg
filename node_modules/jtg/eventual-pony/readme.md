# Eventual Pony

Process streams with generators.

 * Program streams in sync style.
 * Readables, writables or transforms.
 * `pipe()`, backpressure, etc, hooked up.
 * `throw` emits `error` on stream.
 * Backed by [co](https://www.npmjs.com/package/co) so do any co stuff.
 * Awesome name.

--------------------

## API

```js
var pony = require('eventual-pony')
```

### pony.writable([opts], genFunc(input))

 * **opts** - Options object passed to [native Writable constructor](https://iojs.org/api/stream.html#stream_new_stream_writable_options). (optional)
 * **input()** - Returns promise for next available upstream value.

```js
// consume a stream of numbers to produce a sum
var sum = 0
pony({
  objectMode: true
}, function*(input){
  sum += yield input()
}).on('end', function(){
  console.log(sum)
})
```

### pony.readable([opts], genFunc(output))

 * **opts** - Options object passed to [native Readable constructor](https://iojs.org/api/stream.html#stream_new_stream_readable_options). (optional)
 * **output(thing)** - Sends a value downstream. Returns a [yieldable](https://www.npmjs.com/package/co#yieldables) that resolves more or less quickly depending on how fast downstream is accepting data.

```js
// stream of fibonacci numbers
pony.readable({
  objectMode: true
}, function*(output){
  var f1 = 1
    , f2 = 1
  while (true) {
    let result = f2
    f2 = f1
    f1 = f1 + result
    yield output(result)
  }
}).pipe(downstream)
```

### pony.transform([opts], genFunc(input, output))

 * **opts** - Options object passed to [native Transform constructor](https://iojs.org/api/stream.html#stream_new_stream_transform_options). (optional)
 * **input()** - Returns a [yieldable](https://www.npmjs.com/package/co#yieldables) on next available upstream value.
 * **input.ended()** - Once this returns `true` the input is ended, so `output()` any remaining stuff.
 * **output(chunk)** - Sends a value downstream. Returns a [yieldable](https://www.npmjs.com/package/co#yieldables) that resolves more or less quickly depending on how fast downstream is accepting data.

```js
// dedupe an object stream
upstream.pipe(pony({
  objectMode: true
}, function*(inp, out){
  var uniq = new Set()
  var chunk = yield inp()
  if (!uniq.has(chunk)) {
    uniq.add(chunk)
    yield out(chunk)
  }
})).pipe(downstream)
```
