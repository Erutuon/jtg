/*
 * Copyright (c) 2015 by Greg Reimer <gregreimer@gmail.com>
 * All Rights Reserved.
 */

var stream = require('stream')
  , util = require('util')
  , co = require('co')
  , iterationHelper = require('./writable-stream-iteration-helper')

// -----------------------------------------------------

function Writable(opts, genFn) {
  stream.Writable.call(this, opts);
  this._ponyIncomingValues = iterationHelper(this);
  var self = this;
  function input() {
    return self._ponyIncomingValues.next().value;
  }
  co(genFn.bind(this, input))
  .then(function() { self.push(null); })
  .catch(function(err) { self.emit('error', err); })
}

util.inherits(Writable, stream.Writable);

Writable.prototype._write = function(chunk, enc, callback) {
  this.emit('_ponyWriteCalled', chunk, enc, callback);
};

// -----------------------------------------------------

module.exports = Writable;
